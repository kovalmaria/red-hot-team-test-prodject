<style>
  .swiper-button-prev:empty,
  .swiper-button-next:empty {
    display: block;
  }
</style>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css">

<div class="swiper product-swiper">
  <div class="swiper-wrapper">
  </div>

  {% if show_navigation %}
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
  {% endif %}

  {% if show_pagination %}
    <div class="swiper-pagination"></div>
  {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js" defer></script>
<script>
  const variantImages = {};

  {% for media in product.media %}
    {% if media.media_type == 'image' %}
      {% assign color = media.alt | handleize %}
      variantImages["{{ color }}"] = variantImages["{{ color }}"] || [];
      variantImages["{{ color }}"].push({
        src: "{{ media | image_url: width: 1200 }}",
        alt: "{{ media.alt | escape }}",
        width: {{ media.preview_image.width }},
        height: {{ media.preview_image.height }}
      });
    {% endif %}
  {% endfor %}
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const swiper = new Swiper('.product-swiper', {
      spaceBetween: {{ space_between }},
      slidesPerView: {{ slides_per_view_desktop }},
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
        enabled: {{ show_pagination | json }}
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
        enabled: {{ show_navigation | json }}
      },
      breakpoints: {
        320: {
          slidesPerView: {{ slides_per_view_mobile }},
          spaceBetween: {{ space_between }}
        },
        768: {
          slidesPerView: {{ slides_per_view_tablet }},
          spaceBetween: {{ space_between }}
        },
        1024: {
          slidesPerView: {{ slides_per_view_desktop }},
          spaceBetween: {{ space_between }}
        }
      }
    });

    function renderSlides(color) {
      const slides = variantImages[color];
      swiper.removeAllSlides();

      if (!slides || slides.length === 0) {
        swiper.appendSlide('<div class="swiper-slide">No images</div>');
        return;
      }

      const newSlides = slides.map(img => `
        <div class="swiper-slide" data-color="${color}">
          <img src="${img.src}" alt="${img.alt}" width="${img.width}" height="${img.height}" style="width:100%; height:auto;">
        </div>
      `);

      swiper.appendSlide(newSlides);
      swiper.slideTo(0);
    }

    const addListeners = () => {
      const colorInputs = document.querySelectorAll('input[name="Color-1"]');
    
      colorInputs.forEach(input => {
        input.addEventListener('change', () => {
          if (input.checked) {
            const selectedColor = input.value.toLowerCase();
            renderSlides(selectedColor);
          }
        });
      });
    }
    addListeners();

    const container = document.querySelector('.product__info-container');

    const observer = new MutationObserver(mutations => addListeners());
    observer.observe(container, { childList: true, subtree: true });

    const defaultInput = document.querySelector('input[name="Color-1"]:checked');
    if (defaultInput) {
      renderSlides(defaultInput.value.toLowerCase());
    }
  });
</script>
