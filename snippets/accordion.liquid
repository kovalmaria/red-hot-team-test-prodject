{% assign titles = product.metafields.custom.accordion_titles.value %}
{% assign contents = product.metafields.custom.accordion_contents.value %}
{% assign allow_multiple = product.metafields.custom.accordion_multiple_open.value | default: false %}

{% if titles and contents and titles.size > 0 and titles.size == contents.size %}
  <div class="product__accordion accordion quick-add-hidden">
    <div class="product-accordion" data-allow-multiple="{{ allow_multiple }}">
      {% for title in titles %}
        {% assign index = forloop.index0 %}
        {% assign content = contents[index] %}
        {% if content != blank %}
          <details class="accordion-item">
            <summary class="accordion-header">
              <h2 class="h4 accordion__title inline-richtext">{{ title }}</h2>
              {{ 'icon-caret.svg' | inline_asset_content }}
            </summary>
            <div class="accordion__content rte">
              {{ content }}
            </div>
          </details>
        {% endif %}
      {% endfor %}
    </div>
  </div>
{% endif %}


<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.product-accordion').forEach(container => {
      const allowMultiple = container.dataset.allowMultiple === 'true';
  
      container.querySelectorAll('details').forEach(details => {
        details.addEventListener('toggle', () => {
          if (!allowMultiple && details.open) {
            container.querySelectorAll('details').forEach(other => {
              if (other !== details) {
                other.removeAttribute('open');
              }
            });
          }
        });
      });
    });
  });
  
</script>
